<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Headscale, how to self-host tailscale | Nerd things and more...</title>
<meta name=keywords content="tailscale,headscale,netmaker,zerotier,ssh,vpn,OpenWrt"><meta name=description content="Previously, we spoke of how easy is to set a mesh network between your devices with tailscale. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to selfhost this kind of services of their homelab)."><meta name=author content="Me"><link rel=canonical href=https://earvingad.github.io/posts/headscale/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Headscale, how to self-host tailscale"><meta property="og:description" content="Previously, we spoke of how easy is to set a mesh network between your devices with tailscale. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to selfhost this kind of services of their homelab)."><meta property="og:type" content="article"><meta property="og:url" content="https://earvingad.github.io/posts/headscale/"><meta property="og:image" content="https://earvingad.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-25T12:15:56-06:00"><meta property="article:modified_time" content="2023-02-25T12:15:56-06:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://earvingad.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Headscale, how to self-host tailscale"><meta name=twitter:description content="Previously, we spoke of how easy is to set a mesh network between your devices with tailscale. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to selfhost this kind of services of their homelab)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://earvingad.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Headscale, how to self-host tailscale","item":"https://earvingad.github.io/posts/headscale/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Headscale, how to self-host tailscale","name":"Headscale, how to self-host tailscale","description":"Previously, we spoke of how easy is to set a mesh network between your devices with tailscale. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to selfhost this kind of services of their homelab).","keywords":["tailscale","headscale","netmaker","zerotier","ssh","vpn","OpenWrt"],"articleBody":" Previously, we spoke of how easy is to set a mesh network between your devices with tailscale. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to selfhost this kind of services of their homelab). Luckily, headscale exist as An open source, self-hosted implementation of the Tailscale control server. It has support for most of the OS's\nOf course, tailscale is more robust and sophisticated. Headscale only makes use of a single tailnet which is enough for a single organization or your homelab.\nSo we are goint to install headscale assuming the following:\nYou have a VPS that will host headscale running 24/7 and is running Linux (Ubuntu 22.04 is the one I use now). Headscale will be run using the root user. You have created a DNS entry that redirects to your VPS address (see DuckDNS entry if you haven't). Your homelab is behind a NAT not able to forward ports. You have time and want to access your homelab from your phone. Install Headscale On your VPS open TCP ports 80, 443 and 8080 and UDP ports 41641 and 3478 (this is optional to set a DERP relay and you can select another. Then download the binary for your platform from the releases section and save it in the bin path (usually /usr/local/bin/ in ubuntu). Make it executable sudo chmod +x /usr/local/bin/headscale Create database directory: sudo mkdir -p /var/lib/headscale and an empty database sudo touch /var/lib/headscale/db.sqlite And finally create the directory for configuration: sudo mkdir -p /etc/headscale with its configuration sudo touch /etc/headscale/config.yaml Now, for the configuration you can use this template and we need to change the following:\nserver_url: http://127.0.0.1:8080 Change this for your public domain created with duckdns. For exaple: server_url: https://enchilada.duckdns.org:8080 listen_addr: 127.0.0.1:8080 Change it to listen all addresses: listen_addr: 0.0.0.0:8080 ip_prefixes: Here you can modify the subdomain your layer network will have. The default is: 100.64.0.0/10 This means that the connected devices will addresses like 100.64.0.2. derp: This is optional, if enabled the headscale server will act as a relay as well and it will be added to the plublic available derp servers from tailnet. By default DERP server is disabled, if you want it change it to enabled: true. Read here for more info. tls_letsencrypt_hostname: \"\" Add your domins like: tls_letsencrypt_hostname: \"enchilada.duckdns.org\" This is the domain name to request a TLS certificate from LetsEncrypt. tls_letsencrypt_cache_dir: ./cache Change it to tls_letsencrypt_cache_dir: /var/lib/headscale/cache This is where the TLS certificate will be saved. It is already default to /var/lib/headscale/cache commit b684ac0 Thanks to 7kn for pointing this out. dns_config: Here add the DNS server you'd like, by default there is only 1.1.1.1 in the nameservers: section. base_domain: example.com This is for MagisDNS feature, change it to enchilada.duckdns.org Now it will create an entry for devices like: phone.enchilada.duckdns.org that will be reachable for the devices connected. Before first starting headscale, run sudo mkdir -p /var/run/headscale since the socket was moved in a recent update. Thanks to 7kn for pointing this out. Now you can run it with sudo headscale serve to start the server. See here how to create a SystemD service to running it in the background and enable it at boot.\nYou can check with curl http://127.0.0.1:9090/metrics that everything went well and then create the network (tailnet) where you registered devices will communicate (replace mynet with the name you want):\nsudo headscale users create mynet Join devices In order to joint to mynet network, you can use the official tailscale app and run:\nLinux and OpenWrt Simple login can be done with:\nsudo tailscale up --login-server=https://enchilada.duckdns.org:8080/ #Of course replace with your domain If you want to expose your local subnet (devices connected to your OpenWrt router) you should add the flag --advertise-routes=192.168.1.0/24. If you are running OpenWrt 22.03 or later, you need to add the flag --netfilter-mode=off and configure the firewall rules, due to tailscale uses still iptables and latest versions of OpenWrt switched to nftables. See issue here.\nAndroid Here, how to use a custom server in the official tailscale-android app.\nRegistrations to headscale Now, everytime that you add a device with one of the steps above, you will be redirect to a webpage with instructions like this: Image taken from the GuruComputingBlog.\nNOTE: In recent version of Headscale the -n command was substituted by --user\nThe instruction tells you to run the following command (as sudo in our case) in our headscale server:\nsudo headscale --user NAMESPACE nodes register --key Replace NAMESPACE with mynet or the name you gave to your net and that's it.\nYou can check the list of devices (or nodes) by running the following in the headscale server\nsudo headscale nodes list Final thoughts The Guru Computing blog has a nice tutorial for setting headscale. Tailscale/headscale use NAT transversal techniques to establish direct connection between devices and avoid DERP relay servers. I haven't been able to see this working, at least from Phone-to-OpenWrt(router) and have not been able to test another devices since my network is very small. DERP servers are only used when no direct connection can not be established. This will add latency depending on the DERP server. Tailscale/headscale do not use the WireGuard kernel module, but the userspace implementation in go. Kernel module should, in theory, perform better than the userspace implementation. However, in practice you might not be able to tell the difference unless you are a hardcoded IT guy. If you found this content useful, please support me: BTC: 1E2YjL6ysiPxRF4AEdXChpzpesRuyzgE1y ","wordCount":"944","inLanguage":"en","datePublished":"2023-02-25T12:15:56-06:00","dateModified":"2023-02-25T12:15:56-06:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earvingad.github.io/posts/headscale/"},"publisher":{"@type":"Organization","name":"Nerd things and more...","logo":{"@type":"ImageObject","url":"https://earvingad.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://earvingad.github.io/ accesskey=h title="Nerd things and more... (Alt + H)"><img src=https://earvingad.github.io/apple-touch-icon.png alt aria-label=logo height=35>Nerd things and more...</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://earvingad.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://earvingad.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://earvingad.github.io/about/ title=about><span>about</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://earvingad.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://earvingad.github.io/posts/>Posts</a></div><h1 class=post-title>Headscale, how to self-host tailscale</h1><div class=post-meta><span title='2023-02-25 12:15:56 -0600 CST'>February 25, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;944 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/headscale.org rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><figure><img loading=lazy src=https://raw.githubusercontent.com/juanfont/headscale/main/docs/logo/headscale3_header_stacked_left.png></figure></p><p>Previously, we spoke of how easy is to set a mesh network between your devices with <a href=https://earvingad.github.io/posts/tailscale/><span style=text-decoration:underline>tailscale</span></a>. Usually, that will work for most of the people, but in the view that you are using a third party server that might log your activity you would probably want to avoid that and maybe self host the mesh management (there are huge communities that like to <a href=https://www.reddit.com/r/selfhosted/><span style=text-decoration:underline>selfhost</span></a> this kind of services of their <a href=https://www.reddit.com/r/homelab/><span style=text-decoration:underline>homelab</span></a>). Luckily, <a href=https://github.com/juanfont/headscale><span style=text-decoration:underline>headscale</span></a> exist as <em>An open source, self-hosted implementation of the Tailscale control server.</em> It has support for most of the OS's</p><p>Of course, tailscale is more robust and sophisticated. Headscale only makes use of a single tailnet which is enough for a single organization or your homelab.</p><p>So we are goint to install headscale assuming the following:</p><ol><li>You have a VPS that will host headscale running 24/7 and is running Linux (Ubuntu 22.04 is the one I use now).</li><li>Headscale will be run using the root user.</li><li>You have created a DNS entry that redirects to your VPS address (see <a href=https://earvingad.github.io/posts/duckdns/><span style=text-decoration:underline>DuckDNS</span></a> entry if you haven't).</li><li>Your homelab is behind a NAT not able to forward ports.</li><li>You have time and want to access your homelab from your phone.</li></ol><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Install Headscale</h2><div id=outline-text-headline-1 class=outline-text-2><ol><li>On your VPS open TCP ports 80, 443 and 8080 and UDP ports 41641 and 3478 (this is optional to set a DERP relay and you can select another.</li><li>Then download the binary for your platform from the <a href=https://github.com/juanfont/headscale/releases><span style=text-decoration:underline>releases section</span></a> and save it in the bin path (usually <code class=verbatim>/usr/local/bin/</code> in ubuntu).</li><li>Make it executable <code class=verbatim>sudo chmod +x /usr/local/bin/headscale</code></li><li>Create database directory: <code class=verbatim>sudo mkdir -p /var/lib/headscale</code> and an empty database <code class=verbatim>sudo touch /var/lib/headscale/db.sqlite</code></li><li>And finally create the directory for configuration: <code class=verbatim>sudo mkdir -p /etc/headscale</code> with its configuration <code class=verbatim>sudo touch /etc/headscale/config.yaml</code></li></ol><p>Now, for the configuration you can use <a href=https://github.com/juanfont/headscale/blob/main/config-example.yaml><span style=text-decoration:underline>this template</span></a> and we need to change the following:</p><ol><li><code class=verbatim>server_url: http://127.0.0.1:8080</code> Change this for your public domain created with duckdns. For exaple: <code class=verbatim>server_url: https://enchilada.duckdns.org:8080</code></li><li><code class=verbatim>listen_addr: 127.0.0.1:8080</code> Change it to listen all addresses: <code class=verbatim>listen_addr: 0.0.0.0:8080</code></li><li><code class=verbatim>ip_prefixes:</code> Here you can modify the subdomain your layer network will have. The default is: <code class=verbatim>100.64.0.0/10</code> This means that the connected devices will addresses like <code class=verbatim>100.64.0.2</code>.</li><li><code class=verbatim>derp:</code> This is optional, if enabled the headscale server will act as a relay as well and it will be added to the plublic available derp servers from tailnet. By default DERP server is disabled, if you want it change it to <code class=verbatim>enabled: true</code>. Read <a href=https://tailscale.com/kb/1232/derp-servers/><span style=text-decoration:underline>here</span></a> for more info.</li><li><code class=verbatim>tls_letsencrypt_hostname: ""</code> Add your domins like: <code class=verbatim>tls_letsencrypt_hostname: "enchilada.duckdns.org"</code> This is the domain name to request a TLS certificate from LetsEncrypt.</li><li><code class=verbatim>tls_letsencrypt_cache_dir:</code> <del><code class=verbatim>./cache</code> Change it to <code class=verbatim>tls_letsencrypt_cache_dir: /var/lib/headscale/cache</code></del> This is where the TLS certificate will be saved. It is already default to <code class=verbatim>/var/lib/headscale/cache</code> <a href=https://github.com/juanfont/headscale/commit/b684ac06680117b61a6155915380002addd385d8#diff-0997963b54113de6bb19667e1ad7c561a2e6cbba874d4fe671c3e116252f3d25><span style=text-decoration:underline>commit b684ac0</span></a> Thanks to <a href=https://github.com/7kn><span style=text-decoration:underline>7kn</span></a> for pointing this out.</li><li><code class=verbatim>dns_config:</code> Here add the DNS server you'd like, by default there is only <code class=verbatim>1.1.1.1</code> in the <code class=verbatim>nameservers:</code> section.</li><li><code class=verbatim>base_domain: example.com</code> This is for <a href=https://tailscale.com/kb/1081/magicdns/><span style=text-decoration:underline>MagisDNS</span></a> feature, change it to <code class=verbatim>enchilada.duckdns.org</code> Now it will create an entry for devices like: <code class=verbatim>phone.enchilada.duckdns.org</code> that will be reachable for the devices connected.</li><li>Before first starting headscale, run <code class=verbatim>sudo mkdir -p /var/run/headscale</code> since the socket was moved in a <a href=https://github.com/juanfont/headscale/commit/5706f84cb0645af2aad1087a10b5b41e14f508e6><span style=text-decoration:underline>recent update</span></a>. Thanks to <a href=https://github.com/7kn><span style=text-decoration:underline>7kn</span></a> for pointing this out.</li></ol><p>Now you can run it with <code class=verbatim>sudo headscale serve</code> to start the server. See <a href=https://github.com/juanfont/headscale/blob/main/docs/running-headscale-linux.md#running-headscale-in-the-background-with-systemd><span style=text-decoration:underline>here</span></a> how to create a SystemD service to running it in the background and enable it at boot.</p><p>You can check with <code class=verbatim>curl http://127.0.0.1:9090/metrics</code> that everything went well and then create the network (<a href=https://tailscale.com/kb/1136/tailnet/><span style=text-decoration:underline>tailnet</span></a>) where you registered devices will communicate (replace <em>mynet</em> with the name you want):</p><div class="src src-shell"><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo headscale users create mynet</span></span></code></pre></div></div></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Join devices</h2><div id=outline-text-headline-2 class=outline-text-2><p>In order to joint to <em>mynet</em> network, you can use the official tailscale app and run:</p><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Linux and OpenWrt</h3><div id=outline-text-headline-3 class=outline-text-3><p>Simple login can be done with:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo tailscale up --login-server<span class=o>=</span>https://enchilada.duckdns.org:8080/ <span class=c1>#Of course replace with your domain</span></span></span></code></pre></div></div><p>If you want to expose your local subnet (devices connected to your OpenWrt router) you should add the flag <code class=verbatim>--advertise-routes=192.168.1.0/24</code>. If you are running OpenWrt 22.03 or later, you need to add the flag <code class=verbatim>--netfilter-mode=off</code> and configure the firewall rules, due to tailscale uses still <code class=verbatim>iptables</code> and latest versions of OpenWrt switched to <code class=verbatim>nftables</code>. See <a href=https://openwrt.org/docs/guide-user/services/vpn/tailscale/start#openwrt_2203_issue><span style=text-decoration:underline>issue here</span></a>.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Android</h3><div id=outline-text-headline-4 class=outline-text-3><p>Here, how to use a custom server in the official <a href=https://github.com/tailscale/tailscale-android/pull/55><span style=text-decoration:underline>tailscale-android</span></a> app.</p></div></div></div></div><div id=outline-container-headline-5 class=outline-2><h2 id=headline-5>Registrations to headscale</h2><div id=outline-text-headline-5 class=outline-text-2><p>Now, everytime that you add a device with one of the steps above, you will be redirect to a webpage with instructions like this:<figure><img loading=lazy src=https://blog.gurucomputing.com.au/Smart%20VPNS%20with%20Headscale/uploads/acdcc812-abbb-4284-b385-b65eb6f7368b/d4ab0f7e-cccb-4efa-98a8-c26fe6cca8ef/image.png alt="Image taken from the GuruComputingBlog."><figcaption><p>Image taken from the GuruComputingBlog.</p></figcaption></figure></p><p><strong>NOTE: In recent version of Headscale the <code class=verbatim>-n</code> command was substituted by <code class=verbatim>--user</code></strong></p><p>The instruction tells you to run the following command (as sudo in our case) in our headscale server:</p><div class="src src-shell"><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo headscale --user NAMESPACE nodes register --key &lt;a-fuckin-long-key&gt;</span></span></code></pre></div></div><p>Replace <code class=verbatim>NAMESPACE</code> with <em>mynet</em> or the name you gave to your net and that's it.</p><p>You can check the list of devices (or nodes) by running the following in the headscale server</p><div class="src src-shell"><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo headscale nodes list</span></span></code></pre></div></div></div></div><div id=outline-container-headline-6 class=outline-2><h2 id=headline-6>Final thoughts</h2><div id=outline-text-headline-6 class=outline-text-2><ol><li>The <a href=https://blog.gurucomputing.com.au/smart-vpns-with-headscale/><span style=text-decoration:underline>Guru Computing blog</span></a> has a nice tutorial for setting headscale.</li><li>Tailscale/headscale use <a href=https://tailscale.com/blog/how-nat-traversal-works/><span style=text-decoration:underline>NAT transversal</span></a> techniques to establish direct connection between devices and avoid DERP relay servers. I haven't been able to see this working, at least from Phone-to-OpenWrt(router) and have not been able to test another devices since my network is very small.</li><li>DERP servers are only used when no direct connection can not be established. This will add latency depending on the DERP server.</li><li>Tailscale/headscale do not use the WireGuard kernel module, but the <a href=https://tailscale.com/blog/how-tailscale-works/><span style=text-decoration:underline>userspace implementation in go</span></a>. Kernel module should, in theory, perform better than the userspace implementation. However, in practice you might not be able to tell the difference unless you are a hardcoded IT guy.</li></ol><div class="src src-none"><pre tabindex=0><code class=language-none data-lang=none>If you found this content useful, please support me:
BTC: 1E2YjL6ysiPxRF4AEdXChpzpesRuyzgE1y</code></pre></div></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://earvingad.github.io/tags/tailscale/>tailscale</a></li><li><a href=https://earvingad.github.io/tags/headscale/>headscale</a></li><li><a href=https://earvingad.github.io/tags/netmaker/>netmaker</a></li><li><a href=https://earvingad.github.io/tags/zerotier/>zerotier</a></li><li><a href=https://earvingad.github.io/tags/ssh/>ssh</a></li><li><a href=https://earvingad.github.io/tags/vpn/>vpn</a></li><li><a href=https://earvingad.github.io/tags/openwrt/>OpenWrt</a></li></ul><nav class=paginav><a class=prev href=https://earvingad.github.io/posts/homeassistant/><span class=title>« Prev</span><br><span>Home-Assistant, being lazy at home</span>
</a><a class=next href=https://earvingad.github.io/posts/duckdns/><span class=title>Next »</span><br><span>DuckDNS, forget your ip</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on x" href="https://x.com/intent/tweet/?text=Headscale%2c%20how%20to%20self-host%20tailscale&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f&amp;hashtags=tailscale%2cheadscale%2cnetmaker%2czerotier%2cssh%2cvpn%2cOpenWrt"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f&amp;title=Headscale%2c%20how%20to%20self-host%20tailscale&amp;summary=Headscale%2c%20how%20to%20self-host%20tailscale&amp;source=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f&title=Headscale%2c%20how%20to%20self-host%20tailscale"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on whatsapp" href="https://api.whatsapp.com/send?text=Headscale%2c%20how%20to%20self-host%20tailscale%20-%20https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on telegram" href="https://telegram.me/share/url?text=Headscale%2c%20how%20to%20self-host%20tailscale&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Headscale, how to self-host tailscale on ycombinator" href="https://news.ycombinator.com/submitlink?t=Headscale%2c%20how%20to%20self-host%20tailscale&u=https%3a%2f%2fearvingad.github.io%2fposts%2fheadscale%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=earvingad/earvingad.github.io/ issue-term=pathname theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://earvingad.github.io/>Nerd things and more...</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>