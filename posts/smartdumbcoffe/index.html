<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Make smart a dumb coffee machine with ESPHome | Nerd things and more...</title>
<meta name=keywords content="smart,iot,homeassistant,esphome,coffee,water,level,sensor,switch,sonoff"><meta name=description content="As a Coffee lover… of course this post had to start that way.
I have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn't it be a good idea to make it smart so the coffee will be ready when I wake up?"><meta name=author content="Me"><link rel=canonical href=https://earvingad.github.io/posts/smartdumbcoffe/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://earvingad.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Make smart a dumb coffee machine with ESPHome"><meta property="og:description" content="As a Coffee lover… of course this post had to start that way.
I have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn't it be a good idea to make it smart so the coffee will be ready when I wake up?"><meta property="og:type" content="article"><meta property="og:url" content="https://earvingad.github.io/posts/smartdumbcoffe/"><meta property="og:image" content="https://earvingad.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-20T12:58:52-06:00"><meta property="article:modified_time" content="2023-08-20T12:58:52-06:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://earvingad.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Make smart a dumb coffee machine with ESPHome"><meta name=twitter:description content="As a Coffee lover… of course this post had to start that way.
I have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn't it be a good idea to make it smart so the coffee will be ready when I wake up?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://earvingad.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Make smart a dumb coffee machine with ESPHome","item":"https://earvingad.github.io/posts/smartdumbcoffe/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Make smart a dumb coffee machine with ESPHome","name":"Make smart a dumb coffee machine with ESPHome","description":"As a Coffee lover… of course this post had to start that way.\nI have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn\u0026#39;t it be a good idea to make it smart so the coffee will be ready when I wake up?","keywords":["smart","iot","homeassistant","esphome","coffee","water","level","sensor","switch","sonoff"],"articleBody":" As a Coffee lover… of course this post had to start that way.\nI have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn't it be a good idea to make it smart so the coffee will be ready when I wake up?\nYou can google \"smart dumb coffee machine\" and find some cool hacks. Some of them involves coffee machines that already have some programable functions, so they involve cutting some wires and solder them into an ESP8266/ESP32 module in order to use them.\nIn this case, I wanted to be the less intrusive with the coffee machine, meaning that in case of failure I will be able to detach and replace quick and easy. This makes the process more modular, just plug and play.\nI thought about a few key points to make it work:\nThe coffee machine on-off switch must be always on. One relay will control the on-off state of the coffee machine. This can be achieved by a single smart plug. However, the coffee machine will be on even if there is not water in the tank, this could lead to premature damage. In order to solve this, a water level sensor is needed to check if there is water in the tank. As it is needed to work the less intrusive possible, I decided to go with the XKC-Y25-NPN, which is a capacitive sensor so it can be placed outside the water tank. Finally, I decided to use a Sonoff mini R2, it provides a relay, 5V supply and it exposes the GPIO04 and ground trough the switch (S2 and S1 connections, respectively) that can be used to receive the signal of the water level sensor. So minor modifications are needed.\n5V output from MiniR2 to XKC-Y25-NPN According to the schematics, you can take a 5V supply from the MiniR2, Hackaday modded it to add a second switch, and you can see in the image where you can take the 5V supply\nSolder a jumper wire where the 5V is located, it is thin enough to fit the little hole in the MiniR2 so the case will close completely without problem.\nNOTE: ignore the black ground cable, I had to do this fix due to a previous mistake I made.\nConnect the XKC-Y25-NPN The XKC-Y25-NPN has 4 wires:\nBrown: 5V input (Vcc). Blue: Ground. Yellow: Signal. Black: Mode. The black cable is not really needed, but it works this way:\nDisconnected: Yellow wire will be connected to Brown (5V supply)\nThis is the mode we want, as it works as a water detection sensor. If it detects water, it will send the signal, when connected to a led the led will turn on. Or when connected to a relay, it will close the relay turning on a water pump to avoid flooding. If connected to Blue (ground), then Yellow wire will be connected to Blue (ground).\nThis mode is useful to stop a water pump connected trough a relay, when the water reaches certain level. If water is below the desired level the relay will be closed (turning the water pump on), and when the water reaches the desired level it will open the relay (turning the water pump off) Here is a helpful video to understand how it works.\nConnect the wires accordingly:\nBrown to 5V. Yellow to GPIO04 (S2). Blue to ground (S1). ESPHome Code For this part I am assuming you already know how to flash ESPHome in a the MiniR2. If not, take your time to google a little bit.\nThe yaml file includes by default: board, logger, api, ota, webserver, captive portal, etc. But the important part is the GPIO configuration.\nFor the MiniR2 we know:\nGPIO13, is the status led. GPIO12, is the relay. GPIO04, is the switch (S2) GPIO00, is the physical button. And Ground, is in the switch (S1). So we create the entries for the status led and relay:\nstatus_led: pin: number: GPIO13 inverted: true output: - platform: gpio id: relay_1 pin: GPIO12 Then we add a switch. Usually this would be controlled by the GPIO04 (S2) to toggle the relay, but we will use the GPIO04 for the water sensor. So this switch will not be linked to any GPIO but will turn on-off the relay when pressed from the webUI or homeassistant.\nswitch: - platform: output id: switch_1 name: \"minir2 relay state\" output: relay_1 on_turn_on: - output.turn_on: relay_1 on_turn_off: - output.turn_off: relay_1 Then we define the physical button use. On press it will toggle the switch that eventually will turn on or off the relay.\nbinary_sensor: - platform: gpio pin: GPIO00 id: reset internal: true filters: - invert: - delayed_off: 10ms on_press: - switch.toggle: id: switch_1 And finally, under the same binary_sensor declaration we place the water sensor. We add the device_class as moisture so it will show \"Dry\" or \"Wet\" when water is detected. After testing, I had to add the inverted: true in order to display correctly the wet/dry state.\n- platform: gpio id: water_1 name: \"Water tank\" device_class: moisture pin: number: GPIO04 inverted: true mode: INPUT_PULLUP You can find the full yaml file here.\nResult and automation That's it, plug the coffee machine to the MiniR2 (I am using an extension cord) and place the sensor in the desired level. They can be placed with double sided tape, or anything else. Remember it is plug\u0026play.\nOnce connected, add the device in homeassistant and you should see the switch state and water level sensor. Finally, create an automation that follows the next logic:\nFrom Mon-Fri at 7am If water tank = Wet Then turn on relay Sleep for 30 min Then turn off relay. It should look like this in yaml syntax, but I created it using the homeassistant visual editor which is easier to use:\nalias: Turn on coffee - workdays description: Turn on coffee machine at 7:00 am on workdays. trigger: - platform: time at: \"07:00:00\" condition: [] action: - if: - condition: time weekday: - mon - tue - wed - thu - fri - condition: state entity_id: binary_sensor.water_tank state: \"on\" then: - type: turn_on device_id: \u003c..device id..\u003e entity_id: switch.minir2_switch_state domain: switch - delay: hours: 0 minutes: 30 seconds: 0 milliseconds: 0 - type: turn_off device_id: \u003c..device id..\u003e entity_id: switch.minir2_switch_state domain: switch mode: single Final thoughts Well it works and it can be used with the generic Tuya smart switches, you just need to find out where to take the 5V output and configure it using esphome-libretiny. You can add the automation directly to the ESPHome yaml so the device flashed with compiled firmware will work independently from homeassistant. So even if your homeassistant is down, you will still have coffee. To do so, please follow the ESPHome automation guide. I actually have like 4 esp32 that I haven't used. One of them was planned for this purpose, together with a relay and a hlk-pm01, but the MiniR2 provides the relay and power supply in a small form factor, so that was the reason I ended up doing this. Since it worked nicely, now I am planning to use the MiniR2 together with PZEM-04T for energy monitoring. It needs more modding, since the PZEM-04T requires 2 pins for communication Rx/Tx, but I think it is feasible and it will be still small form factor. Enjoy your coffee! ","wordCount":"1246","inLanguage":"en","datePublished":"2023-08-20T12:58:52-06:00","dateModified":"2023-08-20T12:58:52-06:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earvingad.github.io/posts/smartdumbcoffe/"},"publisher":{"@type":"Organization","name":"Nerd things and more...","logo":{"@type":"ImageObject","url":"https://earvingad.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://earvingad.github.io/ accesskey=h title="Nerd things and more... (Alt + H)"><img src=https://earvingad.github.io/apple-touch-icon.png alt aria-label=logo height=35>Nerd things and more...</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://earvingad.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://earvingad.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://earvingad.github.io/about/ title=about><span>about</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://earvingad.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://earvingad.github.io/posts/>Posts</a></div><h1 class=post-title>Make smart a dumb coffee machine with ESPHome</h1><div class=post-meta><span title='2023-08-20 12:58:52 -0600 CST'>August 20, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1246 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/earvingad/earvingad.github.io/posts/smartdumbcoffe.org rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><em>As a Coffee lover…</em> of course this post had to start that way.</p><p>I have a dumb coffee machine for my morning coffee on my way to work. It is just an on-off coffee machine, the brewing cycle last around 10 min and then it just keeps warm the jar. Wouldn't it be a good idea to make it smart so the coffee will be ready when I wake up?</p><p>You can google "smart dumb coffee machine" and find some cool hacks. Some of them involves coffee machines that already have some programable functions, so they involve cutting some wires and solder them into an ESP8266/ESP32 module in order to use them.</p><p>In this case, I wanted to be the less intrusive with the coffee machine, meaning that in case of failure I will be able to detach and replace quick and easy. This makes the process more modular, just plug and play.</p><p>I thought about a few key points to make it work:</p><ol><li>The coffee machine on-off switch must be always on. One relay will control the on-off state of the coffee machine. This can be achieved by a single smart plug. However, the coffee machine will be on even if there is not water in the tank, this could lead to premature damage.</li><li>In order to solve this, a water level sensor is needed to check if there is water in the tank. As it is needed to work the less intrusive possible, I decided to go with the XKC-Y25-NPN, which is a capacitive sensor so it can be placed outside the water tank.</li></ol><p>Finally, I decided to use a Sonoff mini R2, it provides a relay, 5V supply and it exposes the GPIO04 and ground trough the switch (S2 and S1 connections, respectively) that can be used to receive the signal of the water level sensor. So minor modifications are needed.</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>5V output from MiniR2 to XKC-Y25-NPN</h2><div id=outline-text-headline-1 class=outline-text-2><p>According to the schematics, you can take a 5V supply from the MiniR2, <a href=https://hackaday.io/project/176199/instructions><span style=text-decoration:underline>Hackaday modded it to add a second switch</span></a>, and you can see in the image where you can take the 5V supply</p><p><figure><img loading=lazy src=https://cdn.hackaday.io/images/6356251608065534110.jpg></figure></p><p>Solder a jumper wire where the 5V is located, it is thin enough to fit the little hole in the MiniR2 so the case will close completely without problem.</p><table><tbody><tr><td><figure><img loading=lazy src=/posts/img/dumbcoffee/5VoutputMiniR2.jpg></figure></td><td><figure><img loading=lazy src=/posts/img/dumbcoffee/5VoutputMiniR2-0.jpg></figure></td></tr></tbody></table><p>NOTE: ignore the black ground cable, I had to do this fix due to <a href=https://earvingad.github.io/posts/sonoffminir2repair/><span style=text-decoration:underline>a previous mistake I made.</span></a></p></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Connect the XKC-Y25-NPN</h2><div id=outline-text-headline-2 class=outline-text-2><p>The XKC-Y25-NPN has 4 wires:</p><ol><li>Brown: 5V input (Vcc).</li><li>Blue: Ground.</li><li>Yellow: Signal.</li><li>Black: Mode.</li></ol><p>The black cable is not really needed, but it works this way:</p><ul><li><p>Disconnected: Yellow wire will be connected to Brown (5V supply)</p><ul><li>This is the mode we want, as it works as a water detection sensor. If it detects water, it will send the signal, when connected to a led the led will turn on. Or when connected to a relay, it will close the relay turning on a water pump to avoid flooding.</li></ul></li><li><p>If connected to Blue (ground), then Yellow wire will be connected to Blue (ground).</p><ul><li>This mode is useful to stop a water pump connected trough a relay, when the water reaches certain level. If water is below the desired level the relay will be closed (turning the water pump on), and when the water reaches the desired level it will open the relay (turning the water pump off)</li></ul></li></ul><p><a href="https://www.youtube.com/watch?app=desktop&amp;v=W_qJbDwk9DI"><span style=text-decoration:underline>Here is a helpful video</span></a> to understand how it works.</p><p>Connect the wires accordingly:</p><ul><li>Brown to 5V.</li><li>Yellow to GPIO04 (S2).</li><li>Blue to ground (S1).<figure><img loading=lazy src=/posts/img/dumbcoffee/sensorwiring.jpg></figure></li></ul></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>ESPHome Code</h2><div id=outline-text-headline-3 class=outline-text-2><p>For this part I am assuming you already know how to flash ESPHome in a the MiniR2. If not, take your time to google a little bit.</p><p>The yaml file includes by default: board, logger, api, ota, webserver, captive portal, etc. But the important part is the GPIO configuration.</p><p>For the MiniR2 we know:</p><ul><li>GPIO13, is the status led.</li><li>GPIO12, is the relay.</li><li>GPIO04, is the switch (S2)</li><li>GPIO00, is the physical button.</li><li>And Ground, is in the switch (S1).</li></ul><p>So we create the entries for the status led and relay:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>status_led</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=l>GPIO13</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>inverted</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>output</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>gpio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>relay_1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pin</span><span class=p>:</span><span class=w> </span><span class=l>GPIO12</span></span></span></code></pre></div></div><p>Then we add a switch. Usually this would be controlled by the GPIO04 (S2) to toggle the relay, but we will use the GPIO04 for the water sensor. So this switch will not be linked to any GPIO but will turn on-off the relay when pressed from the webUI or homeassistant.</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>switch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>switch_1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;minir2 relay state&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class=l>relay_1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>on_turn_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>output.turn_on</span><span class=p>:</span><span class=w> </span><span class=l>relay_1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>on_turn_off</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>output.turn_off</span><span class=p>:</span><span class=w> </span><span class=l>relay_1</span></span></span></code></pre></div></div><p>Then we define the physical button use. On press it will toggle the switch that eventually will turn on or off the relay.</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>binary_sensor</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>gpio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pin</span><span class=p>:</span><span class=w> </span><span class=l>GPIO00</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>reset</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>filters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>invert</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>delayed_off</span><span class=p>:</span><span class=w> </span><span class=l>10ms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>on_press</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>switch.toggle</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>switch_1</span></span></span></code></pre></div></div><p>And finally, under the same <code class=verbatim>binary_sensor</code> declaration we place the water sensor. We add the <code class=verbatim>device_class</code> as <code class=verbatim>moisture</code> so it will show "Dry" or "Wet" when water is detected. After testing, I had to add the <code class=verbatim>inverted: true</code> in order to display correctly the wet/dry state.</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>gpio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>water_1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Water tank&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>device_class</span><span class=p>:</span><span class=w> </span><span class=l>moisture</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=l>GPIO04</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>inverted</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>INPUT_PULLUP</span></span></span></code></pre></div></div><p>You can find the full yaml file <a href=/posts/img/dumbcoffee/minir2watersensor.yaml><span style=text-decoration:underline>here.</span></a></p></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>Result and automation</h2><div id=outline-text-headline-4 class=outline-text-2><p>That's it, plug the coffee machine to the MiniR2 (I am using an extension cord) and place the sensor in the desired level. They can be placed with double sided tape, or anything else. Remember it is plug&amp;play.</p><p>Once connected, add the device in homeassistant and you should see the switch state and water level sensor.<figure><img loading=lazy src=/posts/img/dumbcoffee/minir2watersensor-HA.png></figure></p><p><figure><img loading=lazy src=/posts/img/dumbcoffee/minir2watersensor-final.jpg></figure></p><p>Finally, create an automation that follows the next logic:</p><ol><li>From Mon-Fri at 7am</li><li>If water tank = Wet</li><li>Then turn on relay</li><li>Sleep for 30 min</li><li>Then turn off relay.</li></ol><p>It should look like this in yaml syntax, but I created it using the homeassistant visual editor which is easier to use:</p><div class="src src-yaml"><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>Turn on coffee - workdays</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Turn on coffee machine at 7:00 am on workdays.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>at</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;07:00:00&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>if</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>weekday</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>mon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>tue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>wed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>thu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>fri</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>binary_sensor.water_tank</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;on&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>then</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>turn_on</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>device_id</span><span class=p>:</span><span class=w> </span><span class=l>&lt;..device id..&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>switch.minir2_switch_state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>domain</span><span class=p>:</span><span class=w> </span><span class=l>switch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>delay</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>hours</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>minutes</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>seconds</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>milliseconds</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>turn_off</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>device_id</span><span class=p>:</span><span class=w> </span><span class=l>&lt;..device id..&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entity_id</span><span class=p>:</span><span class=w> </span><span class=l>switch.minir2_switch_state</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>domain</span><span class=p>:</span><span class=w> </span><span class=l>switch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>single</span></span></span></code></pre></div></div></div></div><div id=outline-container-headline-5 class=outline-2><h2 id=headline-5>Final thoughts</h2><div id=outline-text-headline-5 class=outline-text-2><ul><li>Well it works and it can be used with the generic Tuya smart switches, you just need to find out where to take the 5V output and configure it using esphome-libretiny.</li><li>You can add the automation directly to the ESPHome yaml so the device flashed with compiled firmware will work independently from homeassistant. So even if your homeassistant is down, you will still have coffee. To do so, please follow the <a href=https://esphome.io/guides/automations><span style=text-decoration:underline>ESPHome automation guide.</span></a></li><li>I actually have like 4 esp32 that I haven't used. One of them was planned for this purpose, together with a relay and a hlk-pm01, but the MiniR2 provides the relay and power supply in a small form factor, so that was the reason I ended up doing this.</li><li>Since it worked nicely, now I am planning to use the MiniR2 together with PZEM-04T for energy monitoring. It needs more modding, since the PZEM-04T requires 2 pins for communication Rx/Tx, but I think it is feasible and it will be still small form factor.</li><li>Enjoy your coffee!</li></ul></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://earvingad.github.io/tags/smart/>smart</a></li><li><a href=https://earvingad.github.io/tags/iot/>iot</a></li><li><a href=https://earvingad.github.io/tags/homeassistant/>homeassistant</a></li><li><a href=https://earvingad.github.io/tags/esphome/>esphome</a></li><li><a href=https://earvingad.github.io/tags/coffee/>coffee</a></li><li><a href=https://earvingad.github.io/tags/water/>water</a></li><li><a href=https://earvingad.github.io/tags/level/>level</a></li><li><a href=https://earvingad.github.io/tags/sensor/>sensor</a></li><li><a href=https://earvingad.github.io/tags/switch/>switch</a></li><li><a href=https://earvingad.github.io/tags/sonoff/>sonoff</a></li></ul><nav class=paginav><a class=prev href=https://earvingad.github.io/posts/automatewithpython/><span class=title>« Prev</span><br><span>Automating with Python: A start</span>
</a><a class=next href=https://earvingad.github.io/posts/sonoffminir2repair/><span class=title>Next »</span><br><span>Sonoff mini r2, my screw up and repair</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on x" href="https://x.com/intent/tweet/?text=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f&amp;hashtags=smart%2ciot%2chomeassistant%2cesphome%2ccoffee%2cwater%2clevel%2csensor%2cswitch%2csonoff"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f&amp;title=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome&amp;summary=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome&amp;source=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f&title=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on whatsapp" href="https://api.whatsapp.com/send?text=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome%20-%20https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on telegram" href="https://telegram.me/share/url?text=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome&amp;url=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Make smart a dumb coffee machine with ESPHome on ycombinator" href="https://news.ycombinator.com/submitlink?t=Make%20smart%20a%20dumb%20coffee%20machine%20with%20ESPHome&u=https%3a%2f%2fearvingad.github.io%2fposts%2fsmartdumbcoffe%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=earvingad/earvingad.github.io issue-term=pathname theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://earvingad.github.io/>Nerd things and more...</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>